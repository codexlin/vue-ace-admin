import{an as N,p as h,k as Y,q as p,ar as O,P as ee}from"./framework.DDf-rA-m.js";const C=t=>{if(Array.isArray(t))return t.map(a=>C(a));if(t&&typeof t=="object"){const a={};return Reflect.ownKeys(t).forEach(m=>{const n=Reflect.get(t,m);Reflect.set(a,m,C(n))}),a}return t},te=t=>N(t)?t.value:t,ie=t=>{const a=(t==null?void 0:t.data)??t,m=(a==null?void 0:a.list)??a??[],n=Array.isArray(m)?m:[],s=Number((a==null?void 0:a.total)??n.length??0);return{items:n,total:s}};function ae(t){var q,K,$,x,B,G,H;const a=e=>!!e&&typeof e=="object"&&"state"in e,n=(e=>"pagination"in e||"extra"in e||e.filters!==void 0&&a(e.filters))(t)?t:void 0,s=n?void 0:t,r=(n==null?void 0:n.extra)??(s==null?void 0:s.options)??{};let o,S=!1,b=!0,P=0,y=!0,F=1,w=10,d,v,u=null;if(n){const e=n.filters;e&&(o=e.state,S=e.autoWatch===!0,b=e.resetPageOnChange!==!1,P=S?e.debounce??0:0);const i=n.pagination??{};((q=i.state)==null?void 0:q.current)!==void 0&&(N(i.state.current)?(d=i.state.current,F=d.value??1):F=i.state.current??1),((K=i.state)==null?void 0:K.pageSize)!==void 0&&(N(i.state.pageSize)?(v=i.state.pageSize,w=v.value??10):w=i.state.pageSize??10),y=i.autoWatch!==!1}else if(s){o=s.filters,S=!!o&&(($=s.options)==null?void 0:$.watchFilters)===!0,b=((x=s.options)==null?void 0:x.resetPageOnFilterChange)!==!1,P=S?((B=s.options)==null?void 0:B.filterDebounce)??0:0;const e=((G=s.options)==null?void 0:G.pagination)??{};F=e.current??1,w=e.pageSize??10,y=((H=s.options)==null?void 0:H.autoWatchPagination)!==!1}const l=h(F),f=h(w),R=h(!1),T=h(0),D=h(null),E=h([]),M=o?C(Y(o)??{}):null;let z=!1;const j=async e=>{z=!0;const i=await e();return await ee(),z=!1,i},g=async(e=l.value,i={})=>{var J,Q,U,V;u&&(clearTimeout(u),u=null);const _=te(t.request),A=o?Y(o):void 0,I=((J=r.buildParams)==null?void 0:J.call(r,{page:e,pageSize:f.value,filters:A,extra:i}))??{pageNum:e,pageSize:f.value,...A,...i};R.value=!0,D.value=null;try{const c=await _(I),{items:L,total:X}=((Q=r.transform)==null?void 0:Q.call(r,c))??ie(c);return E.value=L,T.value=Number.isFinite(X)?Number(X):L.length,(U=r.onSuccess)==null||U.call(r,{response:c,items:L,total:T.value,params:I,filters:A}),c}catch(c){if(D.value=c,(V=r.onError)==null||V.call(r,c),r.throwOnError)throw c;return}finally{R.value=!1}},W=(e,{emitLoad:i=!0}={})=>{if(e!==l.value){if(i){l.value=e,y||g(e);return}j(async()=>{l.value=e})}},k=(e,{emitLoad:i=!0}={})=>{if(e!==f.value){if(i){f.value=e,y||g(l.value);return}j(async()=>{f.value=e})}};d&&(p(l,e=>{d&&d.value!==e&&(d.value=e)}),p(d,e=>{e===void 0||e===l.value||W(e,{emitLoad:!1})})),v&&(p(f,e=>{v&&v.value!==e&&(v.value=e)}),p(v,e=>{e===void 0||e===f.value||k(e,{emitLoad:!1})}));const Z=()=>{if(o)return r.resetFilters?r.resetFilters(o):M?o.value=C(M):o.value={},g()};if(y&&p([l,f],()=>{z||g(l.value)}),o&&S){const e=()=>{const i=b?1:l.value;b&&l.value!==1&&W(1,{emitLoad:!1}),g(i)};p(o,()=>{z||(P>0?(u&&clearTimeout(u),u=setTimeout(e,P)):e())},{deep:!0}),P>0&&O(()=>{u&&(clearTimeout(u),u=null)})}return r.immediate&&g(),{dataSource:E,loading:R,total:T,error:D,curPage:l,pageSize:f,loadData:g,reset:Z,setCurPage:W,setPageSize:k}}typeof console<"u"&&console.info(`@codexlin/ace-admin-hooks loaded [${Math.random().toString(36).slice(2,8)}]`);export{ae as u};
